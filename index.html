<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Bâtisseur de Compétences</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .competency-brick {
            touch-action: none;
            cursor: grab;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.3s ease;
        }
        .competency-brick:active {
            cursor: grabbing;
            transform: scale(1.05);
            z-index: 100;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .drop-zone {
            transition: background-color 0.2s ease, border-color 0.2s ease;
            border-style: dashed;
        }
        .drop-zone.drag-over {
            background-color: #dbeafe; /* blue-100 */
            border-color: #3b82f6; /* blue-500 */
        }
        .correct-drop {
            background-color: #dcfce7 !important; /* green-100 */
            border-color: #22c55e !important; /* green-500 */
            cursor: default;
        }
        .incorrect-animation {
            animation: error-shake 0.6s ease-in-out;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.7) !important; /* red-500 */
        }
        @keyframes error-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-6px); }
            20%, 40%, 60%, 80% { transform: translateX(6px); }
        }
        .competency-number {
            display: none;
            font-weight: 600;
            color: #4b5563; /* gray-600 */
        }
        .show-hints .competency-number {
            display: inline;
        }
    </style>
</head>
<body class="bg-slate-200">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
        <header class="text-center mb-6 relative">
            <h1 class="text-3xl font-bold text-slate-800">Le Bâtisseur de Compétences</h1>
            <p id="instructions" class="text-slate-600 mt-1">Faites glisser chaque compétence dans la bonne famille, en respectant l'ordre.</p>
            <button id="hint-button" title="Afficher/Masquer les numéros" class="absolute top-0 right-0 p-2 text-slate-500 hover:text-blue-600 transition-colors">
                <svg id="hint-icon-open" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
            </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Colonne des compétences à trier -->
            <div id="bricks-container" class="bg-white p-4 rounded-lg shadow-md space-y-2 min-h-[500px]">
                <h2 class="font-bold text-lg text-center mb-4">Compétences à classer</h2>
                <!-- Les briques de compétences seront injectées ici par JS -->
            </div>

            <!-- Colonnes des familles (zones de dépôt) -->
            <div class="lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div id="famille-1" class="drop-zone bg-white p-4 rounded-lg shadow-md border-2 border-transparent" data-family="1">
                    <h3 class="font-bold text-center mb-4 text-sky-700">Famille 1<br>Performance opérationelle économique et social</h3>
                    <div class="min-h-[200px] space-y-2"></div>
                </div>
                <div id="famille-2" class="drop-zone bg-white p-4 rounded-lg shadow-md border-2 border-transparent" data-family="2">
                    <h3 class="font-bold text-center mb-4 text-emerald-700">Famille 2<br>Porteur des Transformations</h3>
                     <div class="min-h-[200px] space-y-2"></div>
                </div>
                <div id="famille-3" class="drop-zone bg-white p-4 rounded-lg shadow-md border-2 border-transparent" data-family="3">
                    <h3 class="font-bold text-center mb-4 text-amber-700">Famille 3<br>Ouverture sur l'Environnement</h3>
                     <div class="min-h-[200px] space-y-2"></div>
                </div>
            </div>
        </div>

        <!-- Modale de victoire -->
        <div id="win-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
            <div class="bg-white p-8 rounded-xl shadow-2xl text-center transform transition-all scale-95">
                <h2 class="text-3xl font-bold text-green-600 mb-4">Félicitations !</h2>
                <p class="text-slate-700 mb-6">Vous avez correctement classé toutes les compétences.<br>Vous maîtrisez la structure du référentiel !</p>
                <button onclick="restartGame()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg">
                    Recommencer
                </button>
            </div>
        </div>
    </div>

<script>
    const competencies = [
        { id: 1, family: 1, order: 1, text: "Être acteur de la stratégie et contribuer aux politiques publiques" },
        { id: 2, family: 1, order: 2, text: "Piloter la performance" },
        { id: 3, family: 1, order: 3, text: "Faire preuve de leadership" },
        { id: 4, family: 1, order: 4, text: "Porter les politiques RH et la qualité de vie au travail" },
        { id: 5, family: 1, order: 5, text: "Œuvrer au développement des collaborateurs" },
        { id: 6, family: 1, order: 6, text: "Animer un dialogue constructif avec les instances de décision, de gouvernance et de représentation du personnel" },
        { id: 7, family: 2, order: 7, text: "Connaître les évolutions et anticiper les transformations et leurs impacts" },
        { id: 8, family: 2, order: 8, text: "Imaginer, soutenir et mettre en œuvre des pratiques professionnelles innovantes" },
        { id: 9, family: 2, order: 9, text: "S'adapter au changement" },
        { id: 10, family: 2, order: 10, text: "Conduire des projets et accompagner les transformations" },
        { id: 11, family: 3, order: 11, text: "Appréhender les enjeux de la protection sociale et de son environnement" },
        { id: 12, family: 3, order: 12, text: "Favoriser les coopérations au sein de la Sécurité sociale" },
        { id: 13, family: 3, order: 13, text: "Construire et animer des partenariats externes" },
        { id: 14, family: 3, order: 14, text: "Porter les enjeux et les valeurs de la Sécurité sociale et valoriser son action" },
    ];

    let draggedBrick = null;
    let placedBricksCount = 0;

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function createBrick(comp) {
        const div = document.createElement('div');
        div.id = `brick-${comp.id}`;
        div.className = 'competency-brick bg-gray-100 p-3 rounded-lg shadow-sm border border-gray-200';
        div.draggable = true;
        div.dataset.family = comp.family;
        div.dataset.order = comp.order;
        div.innerHTML = `<span class="competency-number">${comp.order} - </span><p class="inline font-medium text-slate-800">${comp.text}</p>`;
        return div;
    }

    function initGame() {
        const bricksContainer = document.getElementById('bricks-container');
        bricksContainer.innerHTML = '<h2 class="font-bold text-lg text-center mb-4">Compétences à classer</h2>';
        
        shuffle(competencies);
        competencies.forEach(comp => {
            const brick = createBrick(comp);
            bricksContainer.appendChild(brick);
            addBrickEventListeners(brick);
        });

        document.querySelectorAll('.drop-zone div').forEach(zone => zone.innerHTML = '');
        placedBricksCount = 0;
        document.getElementById('win-modal').classList.add('hidden');
        document.body.classList.remove('show-hints');
    }

    function addBrickEventListeners(brick) {
        brick.addEventListener('dragstart', (e) => {
            draggedBrick = e.target.closest('.competency-brick');
            setTimeout(() => draggedBrick.style.opacity = '0.5', 0);
        });

        brick.addEventListener('dragend', (e) => {
            if (draggedBrick) {
                draggedBrick.style.opacity = '1';
                draggedBrick.classList.remove('incorrect-animation');
            }
            draggedBrick = null;
        });
    }

    const dropZones = document.querySelectorAll('.drop-zone');

    dropZones.forEach(zone => {
        zone.addEventListener('dragover', (e) => {
            e.preventDefault();
            zone.classList.add('drag-over');
        });
        zone.addEventListener('dragleave', () => {
            zone.classList.remove('drag-over');
        });
        zone.addEventListener('drop', (e) => {
            e.preventDefault();
            zone.classList.remove('drag-over');
            if (!draggedBrick) return;

            const dropContainer = zone.querySelector('div');
            const existingBricks = dropContainer.querySelectorAll('.competency-brick');
            const lastBrick = existingBricks.length > 0 ? existingBricks[existingBricks.length - 1] : null;

            const droppedFamily = parseInt(draggedBrick.dataset.family, 10);
            const targetFamily = parseInt(zone.dataset.family, 10);
            const droppedOrder = parseInt(draggedBrick.dataset.order, 10);

            let expectedOrder;

            if (lastBrick) {
                // The next expected order is the order of the last brick + 1
                expectedOrder = parseInt(lastBrick.dataset.order, 10) + 1;
            } else {
                // If the zone is empty, find the minimum order for that family
                const familyCompetencies = competencies.filter(c => c.family === targetFamily);
                expectedOrder = Math.min(...familyCompetencies.map(c => c.order));
            }

            if (droppedFamily === targetFamily && droppedOrder === expectedOrder) {
                // Correct drop: correct family and correct order
                dropContainer.appendChild(draggedBrick);
                draggedBrick.draggable = false;
                draggedBrick.classList.add('correct-drop');
                draggedBrick.classList.remove('incorrect-animation');
                placedBricksCount++;
                checkWin();
            } else {
                // Incorrect drop: wrong family or wrong order
                draggedBrick.classList.add('incorrect-animation');
            }
        });
    });

    function checkWin() {
        if (placedBricksCount === competencies.length) {
            const modal = document.getElementById('win-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            setTimeout(() => modal.querySelector('div').classList.add('scale-100'), 10);
        }
    }

    function restartGame() {
        const modal = document.getElementById('win-modal');
        modal.querySelector('div').classList.remove('scale-100');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        initGame();
    }
    
    document.getElementById('hint-button').addEventListener('click', () => {
        document.body.classList.toggle('show-hints');
    });

    document.addEventListener('DOMContentLoaded', initGame);
</script>
</body>
</html>
